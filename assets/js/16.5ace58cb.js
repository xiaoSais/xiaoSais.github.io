(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{186:function(s,e,t){"use strict";t.r(e);var a=t(0),n=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"五、axios-核心类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、axios-核心类","aria-hidden":"true"}},[s._v("#")]),s._v(" 五、Axios 核心类")]),s._v(" "),t("p",[s._v("文件路径 /lib/core/Axios.js")]),s._v(" "),t("h3",{attrs:{id:"axios-构造函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#axios-构造函数","aria-hidden":"true"}},[s._v("#")]),s._v(" Axios 构造函数")]),s._v(" "),t("p",[s._v("在 "),t("a",{attrs:{href:"./constructor.html"}},[s._v("axios实例")]),s._v(" 中，axios 上下文就通过该构造函数创建，axios 实例也是基于 Axios.prototype.request 的。")]),s._v(" "),t("p",[s._v("line 14:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  function Axios(instanceConfig) {\n    // 默认配置选项\n    this.defaults = instanceConfig;\n    this.interceptors = {\n      request: new InterceptorManager(),\n      response: new InterceptorManager()\n    };\n  }\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("该函数给实例挂载了两个属性：axios.deafults 属性为 new Axios(opts) 传入的选项，也就是默认的参数配置。interceptors 为定义的内部拦截器。")]),s._v(" "),t("h3",{attrs:{id:"axios-prototype-request-config"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#axios-prototype-request-config","aria-hidden":"true"}},[s._v("#")]),s._v(" Axios.prototype.request(config)")]),s._v(" "),t("p",[s._v("axios 实例的雏形，主要做了以下几件事情：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("参数处理，允许以 axios('/getList', config) 的格式发起请求：")]),s._v(" "),t("p",[s._v("line 30")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("// 如果第一个参数是字符串，那么配置项就在第二个参数，同时将 config.url 置为第一个参数，否则配置项就是第一个参数\nif (typeof config === 'string') {\n    config = arguments[1] || {};\n    config.url = arguments[0];\n  } else {\n    config = config || {};\n  } \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("line 40")]),s._v(" "),t("p",[s._v("// 设置config.method，统一格式化为小写，如果默认配置和传入的 method 都为false的话这个值置位 'get'")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  if (config.method) {\n      config.method = config.method.toLowerCase();\n    } else if (this.defaults.method) {\n      config.method = this.defaults.method.toLowerCase();\n    } else {\n      config.method = 'get';\n  }\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("合并配置项")]),s._v(" "),t("p",[s._v("将传入配置项和默认配置进行合并, this.defaults， 其实是 axios.defaults, 也就是在 defaults 文件中定义的。")]),s._v(" "),t("p",[s._v("line: 37")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  config = mergeConfig(this.defaults, config);\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("定义拦截器")]),s._v(" "),t("p",[s._v("拦截器相关看这篇文章："),t("a",{attrs:{href:"Interceptors.html"}},[s._v("Axios 拦截器")])])]),s._v(" "),t("li",[t("p",[s._v("返回 promise")]),s._v(" "),t("p",[s._v("line: 64")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  return promise\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("该函数返回一个promise，这也是我们可以使用 axios[method].then() 的原因。")])])]),s._v(" "),t("h3",{attrs:{id:"axios-prototype-method"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#axios-prototype-method","aria-hidden":"true"}},[s._v("#")]),s._v(" Axios.prototype[method]")]),s._v(" "),t("p",[s._v("定义对应的 axios[method] 方法，分为两种需要 | 不需要合并data。")]),s._v(" "),t("p",[s._v("不需要合并 data 选项的 http 请求有：")]),s._v(" "),t("ul",[t("li",[s._v("delete、get、head、options")])]),s._v(" "),t("p",[s._v("需要合并的有：")]),s._v(" "),t("ul",[t("li",[s._v("post、put、patch")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  utils.forEach(['post', 'put', 'patch'], function forEachMethodWithData(method) {\n    /*eslint func-names:0*/\n    Axios.prototype[method] = function(url, data, config) {\n      return this.request(utils.merge(config || {}, {\n        method: method,\n        url: url,\n        data: data\n      }));\n    };\n});\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("内部还是调用了 Axios 原型链上的 Request 方法，并且 config 定义的 method、url、data 参数会被 axios[method] 方法传参所覆盖。")])])}],!1,null,null,null);n.options.__file="Axios.md";e.default=n.exports}}]);