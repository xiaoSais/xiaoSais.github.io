(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{248:function(s,a,n){"use strict";n.r(a);var e=n(17),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"同源策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[s._v("#")]),s._v(" 同源策略")]),s._v(" "),n("p",[s._v("所谓同源就是 协议、ip/host、端口三者都一致。由于浏览器的同源策略限制，不同源脚本不能共享cookie、不能互相操作 dom ，也不能发起 ajax 请求。")]),s._v(" "),n("h2",{attrs:{id:"ajax-请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ajax-请求"}},[s._v("#")]),s._v(" ajax 请求")]),s._v(" "),n("p",[s._v("1、页面所在的服务1(端口3001):")]),s._v(" "),n("p",[s._v("Server:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  const express = require('express')\n  const app = express()\n  const port = 3001\n  app.use(express.static('public'))\n\n  app.get('/data', (req, res) => res.send('Hello World!'))\n\n  app.listen(port, () => console.log(`Example app listening on port ${port}!`))\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("Page:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  <html>\n    <body>\n      <div>page</div>\n    </body>\n  </html>\n  <script src=\"https://unpkg.com/axios/dist/axios.min.js\"></>\n\n  <script>\n    axios.get('http://localhost:3000/data', {\n      firstName: 'lucy',\n      lastName: 'hii'\n    }).then(res => {\n      console.log(res.data)\n    })\n  <\/script>\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("2、接口所在的服务2（端口3000）")]),s._v(" "),n("p",[s._v("Server:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  const express = require('express')\n  const app = express()\n  const port = 3000\n\n  app.get('/data', (req, res) => res.send('Hello World!'))\n\n  app.listen(port, () => console.log(`Example app listening on port ${port}!`))\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("3001 端口的页面试图访问 3000 端口的接口浏览器报错。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("(index):1 Access to XMLHttpRequest at 'http://localhost:3000/data' from origin 'http://localhost:3001' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"dom-无法共享"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dom-无法共享"}},[s._v("#")]),s._v(" DOM 无法共享")]),s._v(" "),n("p",[s._v("如果两个网页不同源就拿不到对方的DOM。")]),s._v(" "),n("p",[s._v("eg: 页面1 http://localhost:3000/index.html")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('  <html>\n  <head>\n    <script src="https://unpkg.com/axios/dist/axios.min.js"><\/script>\n  </head>\n  <body>\n      <div>parent page</div>\n      <div>\n        <iframe src="http://localhost:3001/index.html" id="child"></iframe>\n      </div>\n  </body>\n  <script>\n    console.log(document.getElementById(\'child\').contentWindow)\n  <\/script>\n</html>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("嵌套了一个域为 http://localhost:3001/index.html 的iframw，试图在页面1 获得iframe 的DOM")]),s._v(" "),n("p",[s._v("控制台打印：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('document: [Exception: DOMException: Blocked a frame with origin "http://localhost:3000" from accessing a cross-origin frame. at invokeGetter (<anonymous>:1:142)]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"cookie-无法共享"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-无法共享"}},[s._v("#")]),s._v(" Cookie 无法共享")]),s._v(" "),n("p",[s._v("父页面：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('  <html>\n    <head>\n      <script src="https://unpkg.com/axios/dist/axios.min.js"><\/script>\n    </head>\n    <body>\n        <div>parent page</div>\n        <div>\n          <iframe src="http://localhost:3001/index.html" id="child"></iframe>\n        </div>\n    </body>\n    <script>\n      console.log(document.cookie)\n      document.getElementById(\'child\').onload = function () {\n        console.log( this.contentWindow.document.cookie )\n      }\n    <\/script>\n  </html>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("浏览器控制台报错：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('  Uncaught DOMException: Blocked a frame with origin "http://localhost:3000" from accessing a cross-origin frame.\n    at HTMLIFrameElement.document.getElementById.onload (http://localhost:3000/index.html:14:39)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);