(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{229:function(s,a,e){"use strict";e.r(a);var t=e(17),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"二、axios实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、axios实例"}},[s._v("#")]),s._v(" 二、axios实例")]),s._v(" "),e("p",[s._v("文件路径 index -> lib/axios")]),s._v(" "),e("p",[s._v("引用外部模块：")]),s._v(" "),e("p",[e("a",{attrs:{href:"./tools.html"}},[s._v("1、util工具类")])]),s._v(" "),e("p",[e("a",{attrs:{href:"./config.html"}},[s._v("2、默认参数配置")])]),s._v(" "),e("p",[e("a",{attrs:{href:"./Axios.html"}},[s._v("3、Axios 核心类")])]),s._v(" "),e("p",[e("a",{attrs:{href:"./mergeConfig.html"}},[s._v("4、选项合并")])]),s._v(" "),e("h3",{attrs:{id:"导出"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#导出"}},[s._v("#")]),s._v(" \b导出")]),s._v(" "),e("p",[s._v("官方的使用方式:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  import axios from 'axios'\n  axios({\n    method:'get',\n    url:'http://bit.ly/2mTM3nY',\n    responseType:'stream'\n  }).then(function(response) {\n    response.data.pipe(fs.createWriteStream('ada_lovelace.jpg'))\n  });\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("猜想源码应该导出了一个 axios 实例, 且该实例本身可以是一个函数可以传入配置项。")]),s._v(" "),e("p",[s._v("该文件 line 50 - 53 证实了我们的猜想：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  module.exports = axios;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"创建-axios-实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-axios-实例"}},[s._v("#")]),s._v(" 创建 axios 实例")]),s._v(" "),e("p",[s._v("axios实例 由 createInstance 方法（line 15 - 26）创建，该方法主要做了以下几件事：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  function createInstance(defaultConfig) {\n    var context = new Axios(defaultConfig);\n    var instance = bind(Axios.prototype.request, context);\n\n    // Copy axios.prototype to instance\n    utils.extend(instance, Axios.prototype, context);\n\n    // Copy context to instance\n    utils.extend(instance, context);\n\n    return instance;\n  }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("根据默认参数配置（看资料1）通过 Axios 函数创建 axios 上下文（line 16），参数引于default.js 文件。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  var context = new Axios(defaultConfig);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("创建 axios 实例，该实例也是一个方法，即 Axios.prototype.request，同时该方法 this 绑定到 context，这也是我们可以使用 axios(config) 的原因。（line 17）")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  var instance = bind(Axios.prototype.request, context);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("继承 Axios.prototype 和 context (line 20)")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  utils.extend(instance, Axios.prototype, context);\n\n  utils.extend(instance, context);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("返回 instance")])]),s._v(" "),e("h3",{attrs:{id:"axios-create-config"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#axios-create-config"}},[s._v("#")]),s._v(" axios.create(config)")]),s._v(" "),e("p",[s._v("该 api 可以创建 axios 实例，"),e("a",{attrs:{href:"http://www.axios-js.com/zh-cn/docs/#axios-create-config"}},[s._v("官方文档")]),s._v("。")]),s._v(" "),e("p",[s._v("该 api 内部将传入的配置对象与默认配置进行合并(看资料2)，并调用 createInstance 方法创建实例。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  axios.create = function create(instanceConfig) {\n    return createInstance(mergeConfig(axios.defaults, instanceConfig));\n  };\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"axios-spread-callback"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#axios-spread-callback"}},[s._v("#")]),s._v(" axios.spread(callback)")]),s._v(" "),e("p",[s._v("文档：处理并发请求的助手函数，"),e("a",{attrs:{href:"http://www.axios-js.com/zh-cn/docs/#axios-spread-callback"}},[s._v("并发文档")])]),s._v(" "),e("p",[s._v("引于/helpers/spread，作用是让函数接收数组形式的参数，实现原理是借用apply函数。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  function spread(callback) {\n    return function wrap(arr) {\n      return callback.apply(null, arr);\n    };\n  }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("eg: axios.spread(func)([2,3,4])")]),s._v(" "),e("h3",{attrs:{id:"axios-all-promise"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#axios-all-promise"}},[s._v("#")]),s._v(" axios.all(promise)")]),s._v(" "),e("p",[s._v("作用同 Promise.all(promise)也是用于处理并发的函数，line 45")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("axios.all = function all(promises) {\n  return Promise.all(promises);\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"axios-axios"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#axios-axios"}},[s._v("#")]),s._v(" axios.Axios")]),s._v(" "),e("p",[s._v("将Axios类挂载到 实例的Axios属性上")]),s._v(" "),e("h3",{attrs:{id:"资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[s._v("#")]),s._v(" 资料")]),s._v(" "),e("p",[e("a",{attrs:{href:"./config.html"}},[s._v("1、默认参数配置")])]),s._v(" "),e("p",[e("a",{attrs:{href:"./mergeConfig.html"}},[s._v("2、选项合并")])])])}),[],!1,null,null,null);a.default=n.exports}}]);